# Библиотека для работы с kafka
Эта билиотека основана на node-rdkafka.

## Пример работы Консьюмера

```javascript
const {Consumer} = require("rib-kafka");
async function runConsumer () {
	let consumer = new Consumer({
        topics:["test-topic"],
        config: {"group.id": "test-group", "metadata.broker.list": "192.168.43.204:29092"}, // конфиги консьюмера librdkafka
        topic_config: {"auto.offset.reset": "latest"} // конфиги для работы с топиками (librdkafka) 
    });
    
    try {
        await consumer.connect();

        consumer.on("error", (err) => {
            console.error(err);
        }); // обязательно подписываемся на событие error
    } catch (err) {
        console.error(err); // ошибка при подключении
        return;
    }
    consumer.consume((message, next) => {
        console.log(message); // message => {topic, partition, offset, key, value, timestamp}
        next(); // вызываем next, чтобы получить следующее сообщение. Можно передать первым параметром инстанс error. Тогда, прием сообщений прекратится
        //next(new Error("Some Error"));
    });

    consumer.disconnect(); // чтобы закрыть соединение с брокером
}
```

## Пример работы Продюсера

```javascript
const {Producer} = require("rib-kafka");
async function runProducer () {
    let producer = new Producer({
        config: {"metadata.broker.list": "192.168.43.204:29092"} // конфиги продюсера librdkafka
    });

    try {
        await producer.connect();

        producer.on("error", (err) => {
            console.error(err);
        }); // обязательно подписываемся на событие error
    } catch (err) {
        console.error(err); // ошибка при подключении
        return;
    }

    let sent_msg = await producer.produce(
        "test-topic", // название топика для записи
        0, // номер партиции. Можно передать null, тогда партиция будет выбрана случайным образом
        new Buffer("value"), // value. Обязательно в типе Buffer
        new Buffer("key"), // key. Обязательно в типе Buffer
        new Date() // timestamp
    );

    console.log(sent_msg); // sent_msg => {topic, partition - выбранная партиция (если не была задана вручную), offset - оффсет записанного сообщения, key, value, timestamp}

    producer.disconnect(); // чтобы закрыть соединение с брокером
}
```